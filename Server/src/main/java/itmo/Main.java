package itmo;

import itmo.collection.HashTableCollection;
import itmo.manager.file.ReaderXml;
import itmo.model.Dragon;

import java.net.ServerSocket;
import java.util.ArrayList;
import java.util.List;
import java.util.Scanner;

public class Main {
    public static HashTableCollection<Integer, Dragon> collection = new HashTableCollection<>();
    public static List<Integer> freePorts = new ArrayList<>(50);
    public static String greeting =
            "@@@@@@@@@@%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%@@@@@@@@@@@@@@\n" +
            "@@@@@@%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%@@@@@@@@\n" +
            "@@%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%=%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%@@@@@@\n" +
            "%%%%%%%%%%%%%%%%%%%%%%%%%@@@@%%%%%%%%%%%%%===%%==%%=%%%%%%%%%%%%%%%%%%%%%%%%@@\n" +
            "%%%%%%%%%%%%%%%%%%%%%%@@@@@@%%%%%%%=================%%@#@%%%%%%%%%%%%%%%%%%%%%\n" +
            "%%%%%%%%%%%%%%%%%%%%@@@%%%%%%================++=====%@@@##@%%%%%%%%%%%%%%%%%%%\n" +
            "%%%%%%%%%%%%%%%%%%@@@@@@@%%%===========++=+++++++++++==%=%@#@%%%%%%%%%%%%%%%%%\n" +
            "%%%%%%%%%%%%%%%%%@@@@@%============+++++++++***++++****++=%%@@@%%%%%%%%%%%%%%%\n" +
            "%%%%%%%%%%%%%%%%%@@%%==========+++++++++******+++*++******+=%@@%%%%%%%%%%%%%%%\n" +
            "%%%%%%%%%%%%%===%@%+=========++++++++++********+********++++=%%===%%%%%%%%%%%%\n" +
            "%%%%%%%%%%%%===%%=*:+========++++++++++*+*******************+%%=++=%%%%%%%%%%%\n" +
            "%%%%%%%%%%%++=%%%+*:+=======++++++++*++**********************+%%++*%%%%%%%%%%%\n" +
            "%%%%%%%%%%=+++===+*:+=======+++++****************************+===+++%%%%%%%%%%\n" +
            "%%%%%%%%%%++*+===+*:+=======+++****************::::***********++++++%%%%%%%%%%\n" +
            "%%%%%%%%%=++++====+++=======+++++**+********:::::::***:*******+++=+*=%%%%%%%%%\n" +
            "%%%%%%%%%=+++*+==+*++=======+=++***+*********:::::***************+=+=%%%%%%%%%\n" +
            "%%%%%%%%%=+++=+=+==++=%======++++**+**********:***:::***********+++=+%%%%%%%%%\n" +
            "%%%%%%%%%==+==%=+++++=%======++++********************::**********++++%%%%%%%%%\n" +
            "%%%%%%%=====+==++*+++=======+==+++*********:::::::::*::*********+++++%%%%%%%%%\n" +
            "%%%%%%%%#======+++=++======++++++++**********::*:::::::****+**++++++=*:+%%%%%%\n" +
            "%%%%%%%%=%%%==++++++=%%%%%%@@@@%%==+++++*+*+=+=====+++*****+***+++++**%+%%%%%%\n" +
            "%%%%%%%%==%===+++=%%@%%%@@@@%@@@@@@%=++++=%%@@@@@%%%%=+=++******++++**=+%%%%%%\n" +
            "%%%%%%%%%=%%@=*++===%%@@@@##@@%%%%@@=+***+===%=%@#%++=%+++******+++*:*++@%%%%%\n" +
            "%%%%%%%%%=====+++=====%===%@%+=%%==@%+*:***++++=@=+:*****::****+++=****%%%%%%%\n" +
            "%%%%%%%%%%=++++++========++**+====%@%+*:***+++=****::****:::***+*:**:*%%%%%%%%\n" +
            "%%%%%%%%%%=+==+=+======++++++++===%%%+*:**************:::::***++****:=%%%%%%%%\n" +
            "%%%%%%%%%%%===+========+++++++++=%%%=+*:***::********::::***+++++***+%%%%%%%%%\n" +
            "%%%%%%%%%%%%==+==%%%%===+++++++==%%%=+*****::******:::******++++++*:%%%%%%%%%%\n" +
            "%%%%%%%%%%%%===%%%%%%%%===++++==%%%=+**********************++++***:%%%%%%%%%%%\n" +
            "%%%%%%%%%%%%%%%=%%%%%%==========%%%%+********************++++++**+%%%%%%%%%%%%\n" +
            "%%%%%%%%%%%%%%%=%%%%%%%========%%===+*::::***+************++++=%@%%%%%%%%%%%%%\n" +
            "%%%%%%%%%%%%%%%%%%%%%%%%%=======@@@%==+***=++*************++++%%%%%%%%%%%%%%%%\n" +
            "%%%%%%%%%%%%%%%%%%%%%%%=%%========%@@%%=+**+**************++*+@%%%%%%%%%%%%%%%\n" +
            "%%%%%%%%%%%%%%%%%%%%%%%%%%=========%==%+******************+**%%%%%%%%%%%%%%%%%\n" +
            "%%%%%%%%%%%%%%%%%%%%%%%%===%========*+%=*****************++*=%%%%%%%%%%%%%%%%%\n" +
            "%%%%%%%%%%%%%%%%%%%%%%%%%%%%@@%%%===+**+***+++++++*+***+*+*=%%%%%%%%%%%%%%%%%%\n" +
            "%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%@%%%%=%%%====++++=%%=+**+*+++%%%%%%%%%%%%%%%%%%%\n" +
            "%%%%%%%%%%%%%%%%%@*%@@%%%%%%%%%%%@@%%@%%==+*****+++++++*++%%%%%%%%%%%%%%%%%%%%\n" +
            "%%%%%%%%%%%%%%%##+-:%@%%%%%%%%%%%===++++++++*****++++**+++%%%%%%%%%%%%%%%%%%%%\n" +
            "%%%%%%%%%%%%%%###*:::=#@@@@%%%=++++++++***********++++++*=@%%%%%%%%%%%%%%%%%%%\n" +
            "%%%%%%%%%%%%#####%:::::%#@@@%%%====+++=+****+**+++===+***%@%%%%%%%%%%%%%%%%%%%\n" +
            "%%%%%%%%=@########+*:::::%@%@@@@%%%========++++====+***+:+@%%%%%%%%%%%%%%%%%%%\n" +
            "%%%%%%%############+:*::::-=@%%%%%%%%%%%%%%%%===+++*****.-#%%%%%%%%%%%%%%%%%%%\n" +
            "%%@#################=::::::--*%%===%%%=======+++******+-.-###%%%%%%%%%%%%%%%%%\n" +
            "#####################%-:::::-:-:+==++++==+++*+********-..-#####%%%%%%%%%%%%%%%\n" +
            "######################@::::-----:--+++**+*++++*****:*-..-.+#######@%%%%%%%%%%%\n" +
            "#######################=:::----........:*********:+*......-@###########@%%%%%%\n" +
            "########################:-:----............:++**=+-......--:################@%\n" +
            "#########################-:----...............--:........--.=#################\n" +
            "#########################%-:----..........-@%%%%@%@+.....----@################\n" +
            "##########################+-----........-%@%%%%%%%%@@%...---.+################\n" +
            "###########################-.-........-%@@@@@%%%%%%@@@=*.---.-################\n" +
            "############################-.-......**%@@@##@@%%==%@%**=-.--.+###############\n" +
            "############################=.---..--.-::+@@@##@%%=%@*:****.-.-@##############\n" +
            "#############################*.-.---.-.::--:%#@##@%%@-...:**-.-=##############\n" +
            "##############################:...---.----:-::%@##@%%-.--.-::*.*##############\n" +
            "###############################--.----.----::-*###@%%+.-------::%#############\n" +
            "###############################%.-----.----:::#@##@%%%.:-------*=#############\n" +
            "################################+-----.----::@@@@#@%%#---------**#############\n";
    public static void main(String[] args) throws Exception {
        ReaderXml readerXml = new ReaderXml();
        try {
            collection = readerXml.returnCollect();
        } catch (Exception e) {
            System.out.println("Что-то пошло не так: " + e.getMessage());

        }

        ServerSocket[] serverSockets = new ServerSocket[50];
        ServerRunner[] serverRunners = new ServerRunner[50];
        Thread[] threads = new Thread[50];
        for (int i = 0; i < serverSockets.length; i++) {
            try {
                freePorts.add(8000 + i);
                serverSockets[i] = new ServerSocket(8000 + i);
            } catch (Throwable t){
                System.out.println(i);
                for (Thread thread : threads) {
                    try {
                        thread.interrupt();
                    } catch (Throwable ignore){}
                }
            }

            serverRunners[i] = new ServerRunner(serverSockets[i]);
            threads[i] = new Thread(serverRunners[i]);
            threads[i].start();
        }

        System.out.println("All work");

        new Scanner(System.in).nextLine();
        for (Thread thread : threads) {
            thread.interrupt();
        }
    }
}